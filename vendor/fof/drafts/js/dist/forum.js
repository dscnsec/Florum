module.exports=function(t){var e={};function a(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=t,a.c=e,a.d=function(t,e,o){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(o,n,function(e){return t[e]}.bind(null,n));return o},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=18)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.Model},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/DiscussionComposer"]},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["models/User"]},function(t,e){t.exports=flarum.core.compat["utils/mixin"]},function(t,e){t.exports=flarum.core.compat["components/Page"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["utils/string"]},function(t,e){t.exports=flarum.core.compat["components/HeaderSecondary"]},function(t,e){t.exports=flarum.core.compat["components/NotificationsDropdown"]},function(t,e){t.exports=flarum.core.compat["components/Alert"]},,function(t,e,a){"use strict";a.r(e);var o=a(2),n=a(5),r=a.n(n),i=a(1),s=a.n(i);function c(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var p=a(6),f=function(t){function e(){return t.apply(this,arguments)||this}return c(e,t),e}(a.n(p)()(s.a,{user:s.a.hasOne("user"),content:s.a.attribute("content"),title:s.a.attribute("title"),relationships:s.a.attribute("relationships"),updatedAt:s.a.attribute("updatedAt",s.a.transformDate)})),u=a(7),d=a.n(u),l=a(8),h=a.n(l),y=a(9),b=a.n(y),g=a(3),v=a.n(g),x=a(10),N=a.n(x),w=a(11),O=a.n(w),j=a(12),A=a.n(j),C=a(13),_=a(4),P=a.n(_),k=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var a=e.prototype;return a.init=function(){this.loading=!1},a.config=function(t){t&&$(".draft--delete").on("click tap",function(t){t.stopPropagation()})},a.view=function(){var t=this,e=app.cache.drafts||[];return m("div",{className:"NotificationList RequestsList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},app.translator.trans("fof-drafts.forum.dropdown.title"))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},e.length?e.sort(function(t,e){return e.updatedAt()-t.updatedAt()}).map(function(e){return m("li",null,m("a",{onclick:t.showComposer.bind(t,e),className:"Notification draft--item"},N()(e.user()),O()("fas fa-edit",{className:"Notification-icon"}),m("span",{className:"Notification-content"},e.title()),A()(e.updatedAt()),P.a.component({icon:"fas fa-times",style:"float: right; z-index: 20;",className:"Button Button--icon Button--link draft--delete",title:app.translator.trans("fof-drafts.forum.dropdown.button"),onclick:t.deleteDraft.bind(t,e)}),m("div",{className:"Notification-excerpt"},Object(C.truncate)(e.content(),200))))}):this.loading?b.a.component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},app.translator.trans("fof-drafts.forum.dropdown.empty_text")))))},a.deleteDraft=function(t){this.loading=!0,window.confirm(app.translator.trans("fof-drafts.forum.dropdown.alert"))&&(t.delete(),app.cache.drafts.some(function(e,a){e.id()===t.id()&&app.cache.drafts.splice(a,1)}),app.composer.hide(),this.loading=!1)},a.showComposer=function(t){if(!this.loading){var e=m.deferred(),a={originalContent:t.content(),title:t.title(),user:app.session.user,draft:t};t.relationships()&&Object.keys(t.relationships()).forEach(function(e){t.relationships()[e].data.map(function(a,o){t.relationships()[e].data[o]=app.store.getById(a.type,a.id)}),a[e]=t.relationships()[e].data});var o=new v.a(a);return app.composer.load(o),app.composer.show(),e.resolve(o),e.promise}},a.load=function(){var t=this;app.cache.drafts||(this.loading=!0,m.redraw(),app.store.find("drafts").then(function(t){delete t.payload,app.cache.drafts=t}).catch(function(){}).then(function(){t.loading=!1,m.redraw()}))},e}(h.a),D=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var a=e.prototype;return a.init=function(){t.prototype.init.call(this),app.history.push("drafts"),this.list=new k,this.list.load(),this.bodyClass="App--drafts"},a.view=function(){return m("div",{className:"DraftsPage"},this.list.render())},e}(d.a),B=a(0),S=a.n(B),L=a(14),M=a.n(L),I=a(15),T=function(t){function e(){return t.apply(this,arguments)||this}c(e,t),e.initProps=function(e){e.label=e.label||app.translator.trans("fof-drafts.forum.dropdown.tooltip"),e.icon=e.icon||"fas fa-edit",t.initProps.call(this,e)};var a=e.prototype;return a.init=function(){t.prototype.init.call(this),this.list=new k},a.goToRoute=function(){m.route(app.route("drafts"))},a.getUnreadCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.drafts().length},a.getNewCount=function(){return app.cache.drafts?app.cache.drafts.length:app.session.user.drafts().length},e}(a.n(I).a),R=a(16),z=a.n(R);app.initializers.add("fof-drafts",function(){app.store.models.drafts=f,r.a.prototype.drafts=s.a.hasMany("drafts"),app.routes.drafts={path:"/drafts",component:m(D,null)},Object(o.extend)(v.a.prototype,"headerItems",function(t){var e=this;app.forum.attribute("canSaveDrafts")&&t.add("save-draft",P.a.component({icon:"fas fa-save",className:"Button Button--icon Button--link",style:"margin: 0 10px 2px -10px;",title:app.translator.trans("fof-drafts.forum.composer.title"),onclick:function(){e.draft?(delete e.draft.data.attributes.relationships,e.draft.save(e.data()).then(function(t){app.cache.drafts||(app.cache.drafts=[]),app.cache.drafts.some(function(e,a){if(e.id()===t.id()){var o=new Date;t.data.attributes.updatedAt=o.toString(),app.cache.drafts[a]=t}})})):app.store.createRecord("drafts").save(e.data()).then(function(t){app.cache.drafts?app.cache.drafts.push(t):app.session.user.data.relationships.drafts.data.push(t),m.redraw()}),app.alerts.show(e.successAlert=new z.a({type:"success",children:app.translator.trans("fof-drafts.forum.composer.alert")})),app.composer.hide()}}),20)}),Object(o.extend)(v.a.prototype,"init",function(){var t=this;Object.keys(this.props).forEach(function(e){["originalContent","title","user"].includes(e)?"title"===e&&(t.title=m.prop(t.props.title)):t[e]=t.props[e]})}),Object(o.extend)(v.a.prototype,"onsubmit",function(){var t=this;this.draft&&(this.draft.delete(),app.cache.drafts.some(function(e,a){e.id()===t.draft.id()&&app.cache.drafts.splice(a,1)}))}),Object(o.extend)(M.a.prototype,"items",function(t){S.a.session.user&&(S.a.session.user.drafts()&&S.a.session.user.drafts().length&&!S.a.cache.drafts||S.a.cache.drafts&&0!==S.a.cache.drafts.length)&&t.add("Drafts",m(T,null),20)})})}]);
//# sourceMappingURL=forum.js.map